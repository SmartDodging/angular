<!DOCTYPE html>
<html>
<head>
    <script src="angular.min.js"></script>
</head>
<body>
<center>
    <div ng-app="getTaken" ng-controller="takenCtrl">
        <table class="table table-inverse">
            <tr ng-repeat="x in taken" id="{{x.taak}}">
                <td>
                        <input type="checkbox" name="checked" id="checked" ng-model="taken" ng-change="selvalTaken('{{x.taak}}')">
                </td>
                <td>
                    {{ x.taak }}
                </td>
                <td>
                    {{ x.verantwoordelijke }}
                </td>
                <td>
                <button ng-click="finish()" ng-model="taken">afronden</button>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <center><select name="mySelect" id="mySelect"
                                    ng-options="verantwoordelijke.persoonId as verantwoordelijke.persoon for verantwoordelijke in person"
                                    ng-model="person.persoonId"
                                    style="width: 250px;">
                            </select>
                            <button ng-click="save()">submit</button>
                    </center>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <input type="text" ng-model="addTaak.newTaak">
                    <button ng-click="create()">Voeg taak toe</button>
                </td>
                
            </tr>
        </table>
    </div>
</center>
<script>
    var checkval = "";
    var task = angular.module('getTaken', []);
    task.controller('takenCtrl', ['$scope', '$http', function($scope, $http) {
        $http.get("taken.php")
            .then(function (response) {$scope.taken = response.data.taken;});

        $http.get("setperson.php")
            .then(function (response) {$scope.person = response.data.person;});
        
        $scope.selvalTaken = function (tval) {
			checkval = tval;
		}
        function bindId(){
        $scope.persoonId = $scope.person.persoonId;
        }
        $scope.save = function(){
            bindId();
            $scope.dataObj = {'persoonId': $scope.persoonId, 'taak': checkval};
            console.log($scope.dataObj);
            $scope.info = $http.post('save.php', $scope.dataObj);
            console.log($scope.info);
            //location.reload();
        }
        function newTaak(){
            $scope.makeTaak = $scope.addTaak.newTaak;
        }
        $scope.create = function(){
            newTaak();
            $scope.dataObj = {'taak': $scope.makeTaak};
            console.log($scope.dataObj);
            $scope.info = $http.post('add.php', $scope.dataObj);
            console.log($scope.info);
            //location.reload();
        }
        
        $scope.finish = function(){
            $scope.dataObj = {'taak': checkval};
            $scope.info = $http.post('finish.php', $scope.dataObj);
            //location.reload();
        }
    }]);
    </script>
</body>
</html>
